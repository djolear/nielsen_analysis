---
title: "Nielsen Movers Analysis"
author: "Daniel O'Leary"
date: "3/14/2021"
output:
  github_document:
    toc: true
    toc_depth: 5
---

```{r, include = FALSE}
if (!require("pacman")) install.packages("pacman")

pacman::p_load(
  tidyverse, 
  haven,
  lme4,
  lm.beta,
  broom,
  broom.mixed,
  sjPlot,
  stargazer
)
```

```{r, include = FALSE}
sinfo <- data.frame(Sys.info())
machine <- sinfo$Sys.info..[4]

machine_path <- 
  ifelse(
    machine %in% c("sussman-rp-mbpro.local", "sussman-rp-mbpro.lan"), 
    "/Users/djolear/Google Drive/", 
    "G:/My Drive/"
  )

zip_movers_1yr_calorie_data <- 
  read_csv("D:/data/nielsen/mover_data/zip_movers_1yr_calorie_data.csv")

zip_movers_2yr_calorie_data <- 
  read_csv("D:/data/nielsen/mover_data/zip_movers_2yr_calorie_data.csv")

fips_movers_1yr_calorie_data <- 
  read_csv("D:/data/nielsen/mover_data/fips_movers_1yr_calorie_data.csv")

fips_movers_2yr_calorie_data <- 
  read_csv("D:/data/nielsen/mover_data/fips_movers_2yr_calorie_data.csv")

zip_movers_1yr_spend_data <- 
  read_csv("D:/data/nielsen/mover_data/zip_movers_1yr_spend_data.csv")

zip_movers_2yr_spend_data <- 
  read_csv("D:/data/nielsen/mover_data/zip_movers_2yr_spend_data.csv")

fips_movers_1yr_spend_data <- 
  read_csv("D:/data/nielsen/mover_data/fips_movers_1yr_spend_data.csv")

fips_movers_2yr_spend_data <- 
  read_csv("D:/data/nielsen/mover_data/fips_movers_2yr_spend_data.csv")
```


# Analysis

## Outcome = % of calories in healthy category

### Zipcode moves

#### 1 year

```{r}
 lm_z1 <-
    lmer(
      scale(yes_scale_t2) ~
        scale(yes_scale_t1) +
        
        scale(I(median_income_county_t2 - median_income_county_t1)) +
        median_income_county_scale_t1 +
        
        scale(I(physicians_scale_t2 - physicians_scale_t1)) +
        physicians_scale_t1 +
        
        # scale(I(dentists_t2 - dentists_t1)) +
        # scale(dentists_t1) +
        # 
        # scale(I(therapists_t2 - therapists_t1)) +
        # scale(therapists_t1) +
        
        scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1)) +
        median_monthly_housing_cost_county_scale_t1 +
        
        scale(I(income_t2 - income_t1)) +
        income_scale_t1 +
        
        scale(I(Male_Head_Education_t2 - Male_Head_Education_t1)) +
        Male_Head_Education_scale_t1 +
        
        scale(I(Female_Head_Education_t2 - Female_Head_Education_t1)) +
        Female_Head_Education_scale_t1 +
        
        scale(I(Male_Head_Age_t2 - Male_Head_Age_t1)) +
        Male_Head_Age_scale_t1 +
        
        scale(I(Female_Head_Age_t2 - Female_Head_Age_t1)) +
        Female_Head_Age_scale_t1 +
        
        scale(I(total_pop_county_t2 - total_pop_county_t1)) +
        total_pop_county_scale_t1 +
        
        scale(I(land_area_2010_t2 - land_area_2010_t1)) +
        land_area_2010_scale_t1 +
        
        scale(I(Household_Size_t2 - Household_Size_t1)) +
        Household_Size_scale_t1 +
        
        Race_t1 +
        
        Male_Head_Employment_t1 +
        Female_Head_Employment_t1 +
        Marital_Status_t1 +
        
        Male_Head_Employment_t2 +
        Female_Head_Employment_t2 +
        Marital_Status_t2 +
        
        year_t1 +
        
        (1 + scale(I(median_income_county_t2 - median_income_county_t1))|fips_code_t2) +
        (1|fips_code_t1) +
        (1|household_code) +
        (1|quarter),
      data =
        zip_movers_1yr_calorie_data
    )

summary(lm_z1)
tidy_lm_z1 <- tidy(lm_z1)
tidy_lm_z1
```


##### Plotting coefficients

```{r}
est <- 
  tidy_lm_z1 %>% 
  dplyr::filter(term == "scale(I(median_income_county_t2 - median_income_county_t1))") %>% 
  dplyr::select(estimate)

sjPlot::plot_model(lm_z1) +
  ylim(-0.15, 0.15) +
  labs(title = "predicting % of calorie consumption in healthy categories") +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed")
```

```{r}
tidy_lm_z1 <- tidy(lm_z1)

est <- 
  tidy_lm_z1 %>% 
  dplyr::filter(term == "scale(I(median_income_county_t2 - median_income_county_t1))") %>% 
  dplyr::select(estimate)

tidy_lm_z1 <-
  tidy_lm_z1 %>% 
  mutate(
    dot_color = ifelse(estimate < 0, "red1", ifelse(estimate > 0, "dodgerblue2", NA)),
    se = std.error
  )

tidy_lm_z1 <-
  tidy_lm_z1 %>% 
  filter(
    term == "scale(I(median_income_county_t2 - median_income_county_t1))" |
    term == "median_income_county_scale_t1" |
    term == "scale(I(physicians_scale_t2 - physicians_scale_t1))" | 
    term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))" | 
    term == "scale(I(income_t2 - income_t1))" | 
    term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))" 
  ) %>% 
  mutate(
    variable = 
      case_when(
        term == "scale(I(median_income_county_t2 - median_income_county_t1))" ~ "change in median income",
        term == "median_income_county_scale_t1"  ~ "median income at t1",
        term == "scale(I(physicians_scale_t2 - physicians_scale_t1))"  ~ "change in healthcare access",
        term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))"  ~ "change in housing cost", 
        term == "scale(I(income_t2 - income_t1))"  ~ "change in income",
        term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))"  ~ "change in female education"
      )
  ) 

col <- as.character(tidy_lm_z1$dot_color)
names(col) <- as.character(tidy_lm_z1$dot_color)

calorie_budget_zip_code_moves_1yr <-
  tidy_lm_z1 %>% 
  ggplot(aes(variable, estimate)) +
  geom_point(aes(color = dot_color), size = 4) +
  geom_errorbar(aes(ymin = estimate - 2 * se, ymax = estimate + 2 * se), width = 0) + 
  scale_color_manual(values = col) +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed", color = "red") +
  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed", color = "red") +
  scale_y_continuous(
    breaks = c(-0.15, -0.1, -0.05, 0, 0.05, 0.1, 0.15),
    limits = c(-0.17, 0.17)
  ) +
  labs(
    y = "standardized beta",
    title = "zip code moves, 1 year"
  ) +
  theme_bw() +
  theme(
    text = element_text(size = 17),
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  ) +
  coord_flip()

calorie_budget_zip_code_moves_1yr

ggsave(
  "G:/My Drive/research/projects/niel/nielsen_analysis/relative_status_analysis/plots/calorie_budget_zip_code_moves_1yr.png",
  calorie_budget_zip_code_moves_1yr,
  width = 8,
  height = 6,
  dpi = 500
)
```



#### 2 years

```{r}
 lm_z2 <-
    lmer(
      scale(yes_scale_t2) ~
        scale(yes_scale_t1) +
        
        scale(I(median_income_county_t2 - median_income_county_t1)) +
        median_income_county_scale_t1 +
        
        scale(I(physicians_scale_t2 - physicians_scale_t1)) +
        physicians_scale_t1 +
        
        # scale(I(dentists_t2 - dentists_t1)) +
        # scale(dentists_t1) +
        # 
        # scale(I(therapists_t2 - therapists_t1)) +
        # scale(therapists_t1) +
        
        scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1)) +
        median_monthly_housing_cost_county_scale_t1 +
        
        scale(I(income_t2 - income_t1)) +
        income_scale_t1 +
        
        scale(I(Male_Head_Education_t2 - Male_Head_Education_t1)) +
        Male_Head_Education_scale_t1 +
        
        scale(I(Female_Head_Education_t2 - Female_Head_Education_t1)) +
        Female_Head_Education_scale_t1 +
        
        scale(I(Male_Head_Age_t2 - Male_Head_Age_t1)) +
        Male_Head_Age_scale_t1 +
        
        scale(I(Female_Head_Age_t2 - Female_Head_Age_t1)) +
        Female_Head_Age_scale_t1 +
        
        scale(I(total_pop_county_t2 - total_pop_county_t1)) +
        total_pop_county_scale_t1 +
        
        scale(I(land_area_2010_t2 - land_area_2010_t1)) +
        land_area_2010_scale_t1 +
        
        scale(I(Household_Size_t2 - Household_Size_t1)) +
        Household_Size_scale_t1 +
        
        Race_t1 +
        
        Male_Head_Employment_t1 +
        Female_Head_Employment_t1 +
        Marital_Status_t1 +
        
        Male_Head_Employment_t2 +
        Female_Head_Employment_t2 +
        Marital_Status_t2 +
        
        year_t1 +
        
        (1 + scale(I(median_income_county_t2 - median_income_county_t1))|fips_code_t2) +
        (1|fips_code_t1) +
        (1|household_code) +
        (1|quarter),
      data =
        zip_movers_2yr_calorie_data
    )

summary(lm_z2)
tidy_lm_z2 <- tidy(lm_z2)
tidy_lm_z2
```

```{r}
tidy_lm_z2 <- tidy(lm_z2)

tidy_lm_z2 <-
  tidy_lm_z2 %>% 
  mutate(
    dot_color = ifelse(estimate < 0, "red1", ifelse(estimate > 0, "dodgerblue2", NA)),
    se = std.error
  )

tidy_lm_z2 <-
  tidy_lm_z2 %>% 
  filter(
    term == "scale(I(median_income_county_t2 - median_income_county_t1))" |
    term == "median_income_county_scale_t1" |
    term == "scale(I(physicians_scale_t2 - physicians_scale_t1))" | 
    term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))" | 
    term == "scale(I(income_t2 - income_t1))" | 
    term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))" 
  ) %>% 
  mutate(
    variable = 
      case_when(
        term == "scale(I(median_income_county_t2 - median_income_county_t1))" ~ "change in median income",
        term == "median_income_county_scale_t1"  ~ "median income at t1",
        term == "scale(I(physicians_scale_t2 - physicians_scale_t1))"  ~ "change in healthcare access",
        term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))"  ~ "change in housing cost", 
        term == "scale(I(income_t2 - income_t1))"  ~ "change in income",
        term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))"  ~ "change in female education"
      )
  ) 

col <- as.character(tidy_lm_z2$dot_color)
names(col) <- as.character(tidy_lm_z2$dot_color)

grocery_spend_zipcode_moves_2yr <-
  tidy_lm_z2 %>% 
  ggplot(aes(variable, estimate)) +
  geom_point(aes(color = dot_color), size = 4) +
  geom_errorbar(aes(ymin = estimate - 2 * se, ymax = estimate + 2 * se), width = 0) + 
  scale_color_manual(values = col) +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed") +
  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed") +
  labs(
    y = "standardized beta",
    title = "zip code move, 2 year"
  ) +
  theme_bw() +
  theme(
    text = element_text(size = 17),
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  ) +
  ylim(-0.11, 0.11) +
  coord_flip()

grocery_spend_zipcode_moves_2yr

ggsave(
  "G:/My Drive/research/projects/niel/nielsen_analysis/relative_status_analysis/plots/grocery_spend_zipcode_moves_2yr.png",
  grocery_spend_zipcode_moves_2yr,
  width = 8,
  height = 6,
  dpi = 500
)
```


##### Plotting coefficients

```{r}
est <- 
  tidy_lm_z2 %>% 
  dplyr::filter(term == "scale(I(median_income_county_t2 - median_income_county_t1))") %>% 
  dplyr::select(estimate)

sjPlot::plot_model(lm_z2) +
  ylim(-0.15, 0.15) +
  labs(title = "predicting % of calorie consumption in healthy categories") +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed")
```

```{r}
tidy_lm_z2 <- tidy(lm_z2)

est <- 
  tidy_lm_z2 %>% 
  dplyr::filter(term == "scale(I(median_income_county_t2 - median_income_county_t1))") %>% 
  dplyr::select(estimate)

tidy_lm_z2 <-
  tidy_lm_z2 %>% 
  mutate(
    dot_color = ifelse(estimate < 0, "red1", ifelse(estimate > 0, "dodgerblue2", NA)),
    se = std.error
  )

tidy_lm_z2 <-
  tidy_lm_z2 %>% 
  filter(
    term == "scale(I(median_income_county_t2 - median_income_county_t1))" |
    term == "median_income_county_scale_t1" |
    term == "scale(I(physicians_scale_t2 - physicians_scale_t1))" | 
    term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))" | 
    term == "scale(I(income_t2 - income_t1))" | 
    term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))" 
  ) %>% 
  mutate(
    variable = 
      case_when(
        term == "scale(I(median_income_county_t2 - median_income_county_t1))" ~ "change in median income",
        term == "median_income_county_scale_t1"  ~ "median income at t1",
        term == "scale(I(physicians_scale_t2 - physicians_scale_t1))"  ~ "change in healthcare access",
        term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))"  ~ "change in housing cost", 
        term == "scale(I(income_t2 - income_t1))"  ~ "change in income",
        term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))"  ~ "change in female education"
      )
  ) 

col <- as.character(tidy_lm_z2$dot_color)
names(col) <- as.character(tidy_lm_z2$dot_color)

calorie_budget_zip_code_moves_2yr <-
  tidy_lm_z2 %>% 
  ggplot(aes(variable, estimate)) +
  geom_point(aes(color = dot_color), size = 4) +
  geom_errorbar(aes(ymin = estimate - 2 * se, ymax = estimate + 2 * se), width = 0) + 
  scale_color_manual(values = col) +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed", color = "red") +
  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed", color = "red") +
  scale_y_continuous(
    breaks = c(-0.15, -0.1, -0.05, 0, 0.05, 0.1, 0.15),
    limits = c(-0.17, 0.17)
  ) +
  labs(
    y = "standardized beta",
    title = "zip code moves, 2 year"
  ) +
  theme_bw() +
  theme(
    text = element_text(size = 17),
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  ) +
  coord_flip()

calorie_budget_zip_code_moves_2yr

ggsave(
  "G:/My Drive/research/projects/niel/nielsen_analysis/relative_status_analysis/plots/calorie_budget_zip_code_moves_2yr.png",
  calorie_budget_zip_code_moves_2yr,
  width = 8,
  height = 6,
  dpi = 500
)
```

### County moves

#### 1 year

```{r}
 lm_f1 <-
    lmer(
      scale(yes_scale_t2) ~
        scale(yes_scale_t1) +
        
        scale(I(median_income_county_t2 - median_income_county_t1)) +
        median_income_county_scale_t1 +
        
        scale(I(physicians_scale_t2 - physicians_scale_t1)) +
        physicians_scale_t1 +
        
        # scale(I(dentists_t2 - dentists_t1)) +
        # scale(dentists_t1) +
        # 
        # scale(I(therapists_t2 - therapists_t1)) +
        # scale(therapists_t1) +
        
        scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1)) +
        median_monthly_housing_cost_county_scale_t1 +
        
        scale(I(income_t2 - income_t1)) +
        income_scale_t1 +
        
        scale(I(Male_Head_Education_t2 - Male_Head_Education_t1)) +
        Male_Head_Education_scale_t1 +
        
        scale(I(Female_Head_Education_t2 - Female_Head_Education_t1)) +
        Female_Head_Education_scale_t1 +
        
        scale(I(Male_Head_Age_t2 - Male_Head_Age_t1)) +
        Male_Head_Age_scale_t1 +
        
        scale(I(Female_Head_Age_t2 - Female_Head_Age_t1)) +
        Female_Head_Age_scale_t1 +
        
        scale(I(total_pop_county_t2 - total_pop_county_t1)) +
        total_pop_county_scale_t1 +
        
        scale(I(land_area_2010_t2 - land_area_2010_t1)) +
        land_area_2010_scale_t1 +
        
        scale(I(Household_Size_t2 - Household_Size_t1)) +
        Household_Size_scale_t1 +
        
        Race_t1 +
        
        Male_Head_Employment_t1 +
        Female_Head_Employment_t1 +
        Marital_Status_t1 +
        
        Male_Head_Employment_t2 +
        Female_Head_Employment_t2 +
        Marital_Status_t2 +
        
        year_t1 +
        
        (1 + scale(I(median_income_county_t2 - median_income_county_t1))|fips_code_t2) +
        (1|fips_code_t1) +
        (1|household_code) +
        (1|quarter),
      data =
        fips_movers_1yr_calorie_data
    )

summary(lm_f1)
tidy_lm_f1 <- tidy(lm_f1)
tidy_lm_f1
```

##### Plotting coefficients

```{r}
est <- 
  tidy_lm_f1 %>% 
  dplyr::filter(term == "scale(I(median_income_county_t2 - median_income_county_t1))") %>% 
  dplyr::select(estimate)

sjPlot::plot_model(lm_f1) +
  ylim(-0.15, 0.15) +
  labs(title = "predicting % of calorie consumption in healthy categories") +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed")
```

```{r}
tidy_lm_f1 <- tidy(lm_f1)

est <- 
  tidy_lm_f1 %>% 
  dplyr::filter(term == "scale(I(median_income_county_t2 - median_income_county_t1))") %>% 
  dplyr::select(estimate)

tidy_lm_f1 <-
  tidy_lm_f1 %>% 
  mutate(
    dot_color = ifelse(estimate < 0, "red1", ifelse(estimate > 0, "dodgerblue2", NA)),
    se = std.error
  )

tidy_lm_f1 <-
  tidy_lm_f1 %>% 
  filter(
    term == "scale(I(median_income_county_t2 - median_income_county_t1))" |
    term == "median_income_county_scale_t1" |
    term == "scale(I(physicians_scale_t2 - physicians_scale_t1))" | 
    term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))" | 
    term == "scale(I(income_t2 - income_t1))" | 
    term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))" 
  ) %>% 
  mutate(
    variable = 
      case_when(
        term == "scale(I(median_income_county_t2 - median_income_county_t1))" ~ "change in median income",
        term == "median_income_county_scale_t1"  ~ "median income at t1",
        term == "scale(I(physicians_scale_t2 - physicians_scale_t1))"  ~ "change in healthcare access",
        term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))"  ~ "change in housing cost", 
        term == "scale(I(income_t2 - income_t1))"  ~ "change in income",
        term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))"  ~ "change in female education"
      )
  ) 

col <- as.character(tidy_lm_f1$dot_color)
names(col) <- as.character(tidy_lm_f1$dot_color)

calorie_budget_county_moves_1yr <-
  tidy_lm_f1 %>% 
  ggplot(aes(variable, estimate)) +
  geom_point(aes(color = dot_color), size = 4) +
  geom_errorbar(aes(ymin = estimate - 2 * se, ymax = estimate + 2 * se), width = 0) + 
  scale_color_manual(values = col) +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed", color = "red") +
  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed", color = "red") +
  scale_y_continuous(
    breaks = c(-0.15, -0.1, -0.05, 0, 0.05, 0.1, 0.15),
    limits = c(-0.17, 0.17)
  ) +
  labs(
    y = "standardized beta",
    title = "county moves, 1 year"
  ) +
  theme_bw() +
  theme(
    text = element_text(size = 17),
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  ) +
  coord_flip()

calorie_budget_county_moves_1yr

ggsave(
  "G:/My Drive/research/projects/niel/nielsen_analysis/relative_status_analysis/plots/calorie_budget_county_moves_1yr.png",
  calorie_budget_county_moves_1yr,
  width = 8,
  height = 6,
  dpi = 500
)
```


#### 2 years

```{r}
 lm_f2 <-
    lmer(
      scale(yes_scale_t2) ~
        scale(yes_scale_t1) +
        
        scale(I(median_income_county_t2 - median_income_county_t1)) +
        median_income_county_scale_t1 +
        
        scale(I(physicians_scale_t2 - physicians_scale_t1)) +
        physicians_scale_t1 +
        
        # scale(I(dentists_t2 - dentists_t1)) +
        # scale(dentists_t1) +
        # 
        # scale(I(therapists_t2 - therapists_t1)) +
        # scale(therapists_t1) +
        
        scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1)) +
        median_monthly_housing_cost_county_scale_t1 +
        
        scale(I(income_t2 - income_t1)) +
        income_scale_t1 +
        
        scale(I(Male_Head_Education_t2 - Male_Head_Education_t1)) +
        Male_Head_Education_scale_t1 +
        
        scale(I(Female_Head_Education_t2 - Female_Head_Education_t1)) +
        Female_Head_Education_scale_t1 +
        
        scale(I(Male_Head_Age_t2 - Male_Head_Age_t1)) +
        Male_Head_Age_scale_t1 +
        
        scale(I(Female_Head_Age_t2 - Female_Head_Age_t1)) +
        Female_Head_Age_scale_t1 +
        
        scale(I(total_pop_county_t2 - total_pop_county_t1)) +
        total_pop_county_scale_t1 +
        
        scale(I(land_area_2010_t2 - land_area_2010_t1)) +
        land_area_2010_scale_t1 +
        
        scale(I(Household_Size_t2 - Household_Size_t1)) +
        Household_Size_scale_t1 +
        
        Race_t1 +
        
        Male_Head_Employment_t1 +
        Female_Head_Employment_t1 +
        Marital_Status_t1 +
        
        Male_Head_Employment_t2 +
        Female_Head_Employment_t2 +
        Marital_Status_t2 +
        
        year_t1 +
        
        (1 + scale(I(median_income_county_t2 - median_income_county_t1))|fips_code_t2) +
        (1|fips_code_t1) +
        (1|household_code) +
        (1|quarter),
      data =
        fips_movers_2yr_calorie_data
    )

summary(lm_f2)
tidy_lm_f2 <- tidy(lm_f2)
tidy_lm_f2
```


##### Plotting coefficients

```{r}
est <- 
  tidy_lm_f2 %>% 
  dplyr::filter(term == "scale(I(median_income_county_t2 - median_income_county_t1))") %>% 
  dplyr::select(estimate)

sjPlot::plot_model(lm_f2) +
  ylim(-0.15, 0.15) +
  labs(title = "predicting % of calorie consumption in healthy categories") +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed")
```

```{r}
tidy_lm_f2 <- tidy(lm_f2)

est <- 
  tidy_lm_f2 %>% 
  dplyr::filter(term == "scale(I(median_income_county_t2 - median_income_county_t1))") %>% 
  dplyr::select(estimate)

tidy_lm_f2 <-
  tidy_lm_f2 %>% 
  mutate(
    dot_color = ifelse(estimate < 0, "red1", ifelse(estimate > 0, "dodgerblue2", NA)),
    se = std.error
  )

tidy_lm_f2 <-
  tidy_lm_f2 %>% 
  filter(
    term == "scale(I(median_income_county_t2 - median_income_county_t1))" |
    term == "median_income_county_scale_t1" |
    term == "scale(I(physicians_scale_t2 - physicians_scale_t1))" | 
    term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))" | 
    term == "scale(I(income_t2 - income_t1))" | 
    term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))" 
  ) %>% 
  mutate(
    variable = 
      case_when(
        term == "scale(I(median_income_county_t2 - median_income_county_t1))" ~ "change in median income",
        term == "median_income_county_scale_t1"  ~ "median income at t1",
        term == "scale(I(physicians_scale_t2 - physicians_scale_t1))"  ~ "change in healthcare access",
        term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))"  ~ "change in housing cost", 
        term == "scale(I(income_t2 - income_t1))"  ~ "change in income",
        term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))"  ~ "change in female education"
      )
  ) 

col <- as.character(tidy_lm_f2$dot_color)
names(col) <- as.character(tidy_lm_f2$dot_color)

calorie_budget_county_moves_2yr <-
  tidy_lm_f2 %>% 
  ggplot(aes(variable, estimate)) +
  geom_point(aes(color = dot_color), size = 4) +
  geom_errorbar(aes(ymin = estimate - 2 * se, ymax = estimate + 2 * se), width = 0) + 
  scale_color_manual(values = col) +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed", color = "red") +
  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed", color = "red") +
  scale_y_continuous(
    breaks = c(-0.15, -0.1, -0.05, 0, 0.05, 0.1, 0.15),
    limits = c(-0.17, 0.17)
  ) +
  labs(
    y = "standardized beta",
    title = "county moves, 2 year"
  ) +
  theme_bw() +
  theme(
    text = element_text(size = 17),
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  ) +
  coord_flip()

calorie_budget_county_moves_2yr

ggsave(
  "G:/My Drive/research/projects/niel/nielsen_analysis/relative_status_analysis/plots/calorie_budget_county_moves_2yr.png",
  calorie_budget_county_moves_2yr,
  width = 8,
  height = 6,
  dpi = 500
)
```


## Outcome = % of food spend in healthy category

### Zipcode moves

#### 1 year

```{r}
 lm_z1 <-
    lmer(
      scale(yes_scale_t2) ~
        scale(yes_scale_t1) +
        
        scale(I(median_income_county_t2 - median_income_county_t1)) +
        median_income_county_scale_t1 +
        
        scale(I(physicians_scale_t2 - physicians_scale_t1)) +
        physicians_scale_t1 +
        
        # scale(I(dentists_t2 - dentists_t1)) +
        # scale(dentists_t1) +
        # 
        # scale(I(therapists_t2 - therapists_t1)) +
        # scale(therapists_t1) +
        
        scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1)) +
        median_monthly_housing_cost_county_scale_t1 +
        
        scale(I(income_t2 - income_t1)) +
        income_scale_t1 +
        
        scale(I(Male_Head_Education_t2 - Male_Head_Education_t1)) +
        Male_Head_Education_scale_t1 +
        
        scale(I(Female_Head_Education_t2 - Female_Head_Education_t1)) +
        Female_Head_Education_scale_t1 +
        
        scale(I(Male_Head_Age_t2 - Male_Head_Age_t1)) +
        Male_Head_Age_scale_t1 +
        
        scale(I(Female_Head_Age_t2 - Female_Head_Age_t1)) +
        Female_Head_Age_scale_t1 +
        
        scale(I(total_pop_county_t2 - total_pop_county_t1)) +
        total_pop_county_scale_t1 +
        
        scale(I(land_area_2010_t2 - land_area_2010_t1)) +
        land_area_2010_scale_t1 +
        
        scale(I(Household_Size_t2 - Household_Size_t1)) +
        Household_Size_scale_t1 +
        
        Race_t1 +
        
        Male_Head_Employment_t1 +
        Female_Head_Employment_t1 +
        Marital_Status_t1 +
        
        Male_Head_Employment_t2 +
        Female_Head_Employment_t2 +
        Marital_Status_t2 +
        
        year_t1 +
        
        (1 + scale(I(median_income_county_t2 - median_income_county_t1))|fips_code_t2) +
        (1|fips_code_t1) +
        (1|household_code) +
        (1|quarter),
      data =
        zip_movers_1yr_spend_data
    )

summary(lm_z1)
tidy_lm_z1 <- tidy(lm_z1)
tidy_lm_z1
```


##### Plotting coefficients

```{r}
est <- 
  tidy_lm_z1 %>% 
  dplyr::filter(term == "scale(I(median_income_county_t2 - median_income_county_t1))") %>% 
  dplyr::select(estimate)

sjPlot::plot_model(lm_z1) +
  ylim(-0.15, 0.15) +
  labs(title = "predicting % of spend consumption in healthy categories") +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed")
```

```{r}
tidy_lm_z1 <- tidy(lm_z1)

est <- 
  tidy_lm_z1 %>% 
  dplyr::filter(term == "scale(I(median_income_county_t2 - median_income_county_t1))") %>% 
  dplyr::select(estimate)

tidy_lm_z1 <-
  tidy_lm_z1 %>% 
  mutate(
    dot_color = ifelse(estimate < 0, "red1", ifelse(estimate > 0, "dodgerblue2", NA)),
    se = std.error
  )

tidy_lm_z1 <-
  tidy_lm_z1 %>% 
  filter(
    term == "scale(I(median_income_county_t2 - median_income_county_t1))" |
    term == "median_income_county_scale_t1" |
    term == "scale(I(physicians_scale_t2 - physicians_scale_t1))" | 
    term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))" | 
    term == "scale(I(income_t2 - income_t1))" | 
    term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))" 
  ) %>% 
  mutate(
    variable = 
      case_when(
        term == "scale(I(median_income_county_t2 - median_income_county_t1))" ~ "change in median income",
        term == "median_income_county_scale_t1"  ~ "median income at t1",
        term == "scale(I(physicians_scale_t2 - physicians_scale_t1))"  ~ "change in healthcare access",
        term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))"  ~ "change in housing cost", 
        term == "scale(I(income_t2 - income_t1))"  ~ "change in income",
        term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))"  ~ "change in female education"
      )
  ) 

col <- as.character(tidy_lm_z1$dot_color)
names(col) <- as.character(tidy_lm_z1$dot_color)

grocery_spend_zip_code_moves_1yr <-
  tidy_lm_z1 %>% 
  ggplot(aes(variable, estimate)) +
  geom_point(aes(color = dot_color), size = 4) +
  geom_errorbar(aes(ymin = estimate - 2 * se, ymax = estimate + 2 * se), width = 0) + 
  scale_color_manual(values = col) +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed", color = "red") +
  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed", color = "red") +
  scale_y_continuous(
    breaks = c(-0.15, -0.1, -0.05, 0, 0.05, 0.1, 0.15),
    limits = c(-0.17, 0.17)
  ) +
  labs(
    y = "standardized beta",
    title = "zip code moves, 1 year"
  ) +
  theme_bw() +
  theme(
    text = element_text(size = 17),
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  ) +
  coord_flip()

grocery_spend_zip_code_moves_1yr

ggsave(
  "G:/My Drive/research/projects/niel/nielsen_analysis/relative_status_analysis/plots/grocery_spend_zip_code_moves_1yr.png",
  grocery_spend_zip_code_moves_1yr,
  width = 8,
  height = 6,
  dpi = 500
)
```


#### 2 years

```{r}
 lm_z2 <-
    lmer(
      scale(yes_scale_t2) ~
        scale(yes_scale_t1) +
        
        scale(I(median_income_county_t2 - median_income_county_t1)) +
        median_income_county_scale_t1 +
        
        scale(I(physicians_scale_t2 - physicians_scale_t1)) +
        physicians_scale_t1 +
        
        # scale(I(dentists_t2 - dentists_t1)) +
        # scale(dentists_t1) +
        # 
        # scale(I(therapists_t2 - therapists_t1)) +
        # scale(therapists_t1) +
        
        scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1)) +
        median_monthly_housing_cost_county_scale_t1 +
        
        scale(I(income_t2 - income_t1)) +
        income_scale_t1 +
        
        scale(I(Male_Head_Education_t2 - Male_Head_Education_t1)) +
        Male_Head_Education_scale_t1 +
        
        scale(I(Female_Head_Education_t2 - Female_Head_Education_t1)) +
        Female_Head_Education_scale_t1 +
        
        scale(I(Male_Head_Age_t2 - Male_Head_Age_t1)) +
        Male_Head_Age_scale_t1 +
        
        scale(I(Female_Head_Age_t2 - Female_Head_Age_t1)) +
        Female_Head_Age_scale_t1 +
        
        scale(I(total_pop_county_t2 - total_pop_county_t1)) +
        total_pop_county_scale_t1 +
        
        scale(I(land_area_2010_t2 - land_area_2010_t1)) +
        land_area_2010_scale_t1 +
        
        scale(I(Household_Size_t2 - Household_Size_t1)) +
        Household_Size_scale_t1 +
        
        Race_t1 +
        
        Male_Head_Employment_t1 +
        Female_Head_Employment_t1 +
        Marital_Status_t1 +
        
        Male_Head_Employment_t2 +
        Female_Head_Employment_t2 +
        Marital_Status_t2 +
        
        year_t1 +
        
        (1 + scale(I(median_income_county_t2 - median_income_county_t1))|fips_code_t2) +
        (1|fips_code_t1) +
        (1|household_code) +
        (1|quarter),
      data =
        zip_movers_2yr_spend_data
    )

summary(lm_z2)
tidy_lm_z2 <- tidy(lm_z2)
tidy_lm_z2
```


##### Plotting coefficients

```{r}
est <- 
  tidy_lm_z2 %>% 
  dplyr::filter(term == "scale(I(median_income_county_t2 - median_income_county_t1))") %>% 
  dplyr::select(estimate)

sjPlot::plot_model(lm_z2) +
  ylim(-0.15, 0.15) +
  labs(title = "predicting % of spend consumption in healthy categories") +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed")
```

```{r}
tidy_lm_z2 <- tidy(lm_z2)

est <- 
  tidy_lm_z2 %>% 
  dplyr::filter(term == "scale(I(median_income_county_t2 - median_income_county_t1))") %>% 
  dplyr::select(estimate)

tidy_lm_z2 <-
  tidy_lm_z2 %>% 
  mutate(
    dot_color = ifelse(estimate < 0, "red1", ifelse(estimate > 0, "dodgerblue2", NA)),
    se = std.error
  )

tidy_lm_z2 <-
  tidy_lm_z2 %>% 
  filter(
    term == "scale(I(median_income_county_t2 - median_income_county_t1))" |
    term == "median_income_county_scale_t1" |
    term == "scale(I(physicians_scale_t2 - physicians_scale_t1))" | 
    term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))" | 
    term == "scale(I(income_t2 - income_t1))" | 
    term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))" 
  ) %>% 
  mutate(
    variable = 
      case_when(
        term == "scale(I(median_income_county_t2 - median_income_county_t1))" ~ "change in median income",
        term == "median_income_county_scale_t1"  ~ "median income at t1",
        term == "scale(I(physicians_scale_t2 - physicians_scale_t1))"  ~ "change in healthcare access",
        term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))"  ~ "change in housing cost", 
        term == "scale(I(income_t2 - income_t1))"  ~ "change in income",
        term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))"  ~ "change in female education"
      )
  ) 

col <- as.character(tidy_lm_z2$dot_color)
names(col) <- as.character(tidy_lm_z2$dot_color)

grocery_spend_zip_code_moves_2yr <-
  tidy_lm_z2 %>% 
  ggplot(aes(variable, estimate)) +
  geom_point(aes(color = dot_color), size = 4) +
  geom_errorbar(aes(ymin = estimate - 2 * se, ymax = estimate + 2 * se), width = 0) + 
  scale_color_manual(values = col) +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed", color = "red") +
  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed", color = "red") +
  scale_y_continuous(
    breaks = c(-0.15, -0.1, -0.05, 0, 0.05, 0.1, 0.15),
    limits = c(-0.17, 0.17)
  ) +
  labs(
    y = "standardized beta",
    title = "zip code moves, 2 year"
  ) +
  theme_bw() +
  theme(
    text = element_text(size = 17),
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  ) +
  coord_flip()

grocery_spend_zip_code_moves_2yr

ggsave(
  "G:/My Drive/research/projects/niel/nielsen_analysis/relative_status_analysis/plots/grocery_spend_zip_code_moves_2yr.png",
  grocery_spend_zip_code_moves_2yr,
  width = 8,
  height = 6,
  dpi = 500
)
```


### County moves

#### 1 year

```{r}
 lm_f1 <-
    lmer(
      scale(yes_scale_t2) ~
        scale(yes_scale_t1) +
        
        scale(I(median_income_county_t2 - median_income_county_t1)) +
        median_income_county_scale_t1 +
        
        scale(I(physicians_scale_t2 - physicians_scale_t1)) +
        physicians_scale_t1 +
        
        # scale(I(dentists_t2 - dentists_t1)) +
        # scale(dentists_t1) +
        # 
        # scale(I(therapists_t2 - therapists_t1)) +
        # scale(therapists_t1) +
        
        scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1)) +
        median_monthly_housing_cost_county_scale_t1 +
        
        scale(I(income_t2 - income_t1)) +
        income_scale_t1 +
        
        scale(I(Male_Head_Education_t2 - Male_Head_Education_t1)) +
        Male_Head_Education_scale_t1 +
        
        scale(I(Female_Head_Education_t2 - Female_Head_Education_t1)) +
        Female_Head_Education_scale_t1 +
        
        scale(I(Male_Head_Age_t2 - Male_Head_Age_t1)) +
        Male_Head_Age_scale_t1 +
        
        scale(I(Female_Head_Age_t2 - Female_Head_Age_t1)) +
        Female_Head_Age_scale_t1 +
        
        scale(I(total_pop_county_t2 - total_pop_county_t1)) +
        total_pop_county_scale_t1 +
        
        scale(I(land_area_2010_t2 - land_area_2010_t1)) +
        land_area_2010_scale_t1 +
        
        scale(I(Household_Size_t2 - Household_Size_t1)) +
        Household_Size_scale_t1 +
        
        Race_t1 +
        
        Male_Head_Employment_t1 +
        Female_Head_Employment_t1 +
        Marital_Status_t1 +
        
        Male_Head_Employment_t2 +
        Female_Head_Employment_t2 +
        Marital_Status_t2 +
        
        year_t1 +
        
        (1 + scale(I(median_income_county_t2 - median_income_county_t1))|fips_code_t2) +
        (1|fips_code_t1) +
        (1|household_code) +
        (1|quarter),
      data =
        fips_movers_1yr_spend_data
    )

summary(lm_f1)
tidy_lm_f1 <- tidy(lm_f1)
tidy_lm_f1
```

##### Plotting coefficients

```{r}
est <- 
  tidy_lm_f1 %>% 
  dplyr::filter(term == "scale(I(median_income_county_t2 - median_income_county_t1))") %>% 
  dplyr::select(estimate)

sjPlot::plot_model(lm_f1) +
  ylim(-0.15, 0.15) +
  labs(title = "predicting % of spend consumption in healthy categories") +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed")
```

```{r}
tidy_lm_f1 <- tidy(lm_f1)

est <- 
  tidy_lm_f1 %>% 
  dplyr::filter(term == "scale(I(median_income_county_t2 - median_income_county_t1))") %>% 
  dplyr::select(estimate)

tidy_lm_f1 <-
  tidy_lm_f1 %>% 
  mutate(
    dot_color = ifelse(estimate < 0, "red1", ifelse(estimate > 0, "dodgerblue2", NA)),
    se = std.error
  )

tidy_lm_f1 <-
  tidy_lm_f1 %>% 
  filter(
    term == "scale(I(median_income_county_t2 - median_income_county_t1))" |
    term == "median_income_county_scale_t1" |
    term == "scale(I(physicians_scale_t2 - physicians_scale_t1))" | 
    term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))" | 
    term == "scale(I(income_t2 - income_t1))" | 
    term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))" 
  ) %>% 
  mutate(
    variable = 
      case_when(
        term == "scale(I(median_income_county_t2 - median_income_county_t1))" ~ "change in median income",
        term == "median_income_county_scale_t1"  ~ "median income at t1",
        term == "scale(I(physicians_scale_t2 - physicians_scale_t1))"  ~ "change in healthcare access",
        term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))"  ~ "change in housing cost", 
        term == "scale(I(income_t2 - income_t1))"  ~ "change in income",
        term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))"  ~ "change in female education"
      )
  ) 

col <- as.character(tidy_lm_f1$dot_color)
names(col) <- as.character(tidy_lm_f1$dot_color)

grocery_spend_county_moves_1yr <-
  tidy_lm_f1 %>% 
  ggplot(aes(variable, estimate)) +
  geom_point(aes(color = dot_color), size = 4) +
  geom_errorbar(aes(ymin = estimate - 2 * se, ymax = estimate + 2 * se), width = 0) + 
  scale_color_manual(values = col) +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed", color = "red") +
  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed", color = "red") +
  scale_y_continuous(
    breaks = c(-0.15, -0.1, -0.05, 0, 0.05, 0.1, 0.15),
    limits = c(-0.17, 0.17)
  ) +
  labs(
    y = "standardized beta",
    title = "county moves, 1 year"
  ) +
  theme_bw() +
  theme(
    text = element_text(size = 17),
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  ) +
  coord_flip()

grocery_spend_county_moves_1yr

ggsave(
  "G:/My Drive/research/projects/niel/nielsen_analysis/relative_status_analysis/plots/grocery_spend_county_moves_1yr.png",
  grocery_spend_county_moves_1yr,
  width = 8,
  height = 6,
  dpi = 500
)
```


#### 2 years

```{r}
 lm_f2 <-
    lmer(
      scale(yes_scale_t2) ~
        scale(yes_scale_t1) +
        
        scale(I(median_income_county_t2 - median_income_county_t1)) +
        median_income_county_scale_t1 +
        
        scale(I(physicians_scale_t2 - physicians_scale_t1)) +
        physicians_scale_t1 +
        
        # scale(I(dentists_t2 - dentists_t1)) +
        # scale(dentists_t1) +
        # 
        # scale(I(therapists_t2 - therapists_t1)) +
        # scale(therapists_t1) +
        
        scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1)) +
        median_monthly_housing_cost_county_scale_t1 +
        
        scale(I(income_t2 - income_t1)) +
        income_scale_t1 +
        
        scale(I(Male_Head_Education_t2 - Male_Head_Education_t1)) +
        Male_Head_Education_scale_t1 +
        
        scale(I(Female_Head_Education_t2 - Female_Head_Education_t1)) +
        Female_Head_Education_scale_t1 +
        
        scale(I(Male_Head_Age_t2 - Male_Head_Age_t1)) +
        Male_Head_Age_scale_t1 +
        
        scale(I(Female_Head_Age_t2 - Female_Head_Age_t1)) +
        Female_Head_Age_scale_t1 +
        
        scale(I(total_pop_county_t2 - total_pop_county_t1)) +
        total_pop_county_scale_t1 +
        
        scale(I(land_area_2010_t2 - land_area_2010_t1)) +
        land_area_2010_scale_t1 +
        
        scale(I(Household_Size_t2 - Household_Size_t1)) +
        Household_Size_scale_t1 +
        
        Race_t1 +
        
        Male_Head_Employment_t1 +
        Female_Head_Employment_t1 +
        Marital_Status_t1 +
        
        Male_Head_Employment_t2 +
        Female_Head_Employment_t2 +
        Marital_Status_t2 +
        
        year_t1 +
        
        (1 + scale(I(median_income_county_t2 - median_income_county_t1))|fips_code_t2) +
        (1|fips_code_t1) +
        (1|household_code) +
        (1|quarter),
      data =
        fips_movers_2yr_spend_data
    )

summary(lm_f2)
tidy_lm_f2 <- tidy(lm_f2)
tidy_lm_f2
```


##### Plotting coefficients

```{r}
est <- 
  tidy_lm_f2 %>% 
  dplyr::filter(term == "scale(I(median_income_county_t2 - median_income_county_t1))") %>% 
  dplyr::select(estimate)

sjPlot::plot_model(lm_f2) +
  ylim(-0.15, 0.15) +
  labs(title = "predicting % of spend consumption in healthy categories") +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed")
```


```{r}
tidy_lm_f2 <- tidy(lm_f2)

est <- 
  tidy_lm_f2 %>% 
  dplyr::filter(term == "scale(I(median_income_county_t2 - median_income_county_t1))") %>% 
  dplyr::select(estimate)

tidy_lm_f2 <-
  tidy_lm_f2 %>% 
  mutate(
    dot_color = ifelse(estimate < 0, "red1", ifelse(estimate > 0, "dodgerblue2", NA)),
    se = std.error
  )

tidy_lm_f2 <-
  tidy_lm_f2 %>% 
  filter(
    term == "scale(I(median_income_county_t2 - median_income_county_t1))" |
    term == "median_income_county_scale_t1" |
    term == "scale(I(physicians_scale_t2 - physicians_scale_t1))" | 
    term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))" | 
    term == "scale(I(income_t2 - income_t1))" | 
    term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))" 
  ) %>% 
  mutate(
    variable = 
      case_when(
        term == "scale(I(median_income_county_t2 - median_income_county_t1))" ~ "change in median income",
        term == "median_income_county_scale_t1"  ~ "median income at t1",
        term == "scale(I(physicians_scale_t2 - physicians_scale_t1))"  ~ "change in healthcare access",
        term == "scale(I(median_monthly_housing_cost_county_t2 - median_monthly_housing_cost_county_t1))"  ~ "change in housing cost", 
        term == "scale(I(income_t2 - income_t1))"  ~ "change in income",
        term == "scale(I(Female_Head_Education_t2 - Female_Head_Education_t1))"  ~ "change in female education"
      )
  ) 

col <- as.character(tidy_lm_f2$dot_color)
names(col) <- as.character(tidy_lm_f2$dot_color)

grocery_spend_county_moves_2yr <-
  tidy_lm_f2 %>% 
  ggplot(aes(variable, estimate)) +
  geom_point(aes(color = dot_color), size = 4) +
  geom_errorbar(aes(ymin = estimate - 2 * se, ymax = estimate + 2 * se), width = 0) + 
  scale_color_manual(values = col) +
  geom_hline(yintercept = -abs(est$estimate), linetype = "dashed", color = "red") +
  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_hline(yintercept = abs(est$estimate), linetype = "dashed", color = "red") +
  scale_y_continuous(
    breaks = c(-0.15, -0.1, -0.05, 0, 0.05, 0.1, 0.15),
    limits = c(-0.17, 0.17)
  ) +
  labs(
    y = "standardized beta",
    title = "county moves, 2 year"
  ) +
  theme_bw() +
  theme(
    text = element_text(size = 17),
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  ) +
  coord_flip()

grocery_spend_county_moves_2yr

ggsave(
  "G:/My Drive/research/projects/niel/nielsen_analysis/relative_status_analysis/plots/grocery_spend_county_moves_2yr.png",
  grocery_spend_county_moves_2yr,
  width = 8,
  height = 6,
  dpi = 500
)
```
